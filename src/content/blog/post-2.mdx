---
title: Why JMAP Protocol is Faster
subtitle: JMAP significantly improves email communication speed and efficiency by bundling multiple operations into a single request, reducing the roundtrips needed for synchronization tasks compared to IMAP. This blog post will explain with short examples why JMAP is faster.
image: "/images/posts/jmap-vs-imap.png"
author: Al Murad Uzzaman
date: 2024-06-15T05:00:00Z
categories: ["Tech"]
featured: false
draft: false
---

The JSON Meta Application Protocol (JMAP) is a new protocol for email communication.
JMAP was designed to address many of the limitations and complexities of IMAP, providing a more efficient and developer-friendly approach to email synchronization and access.
Although JMAP provides many significant and subtle improvements, for clarity, this blog post will provide examples specifically with initial synchronization and re-synchronization to illustrate why JMAP is faster.

## Initial Synchronization

Mailtemi, which supports both IMAP and JMAP, provides a practical demonstration of these protocols in action. For simplicity, let's consider a scenario involving three mail folders (referred to as mailboxes in RFCs, but often called folders or labels in user interfaces): Inbox, Drafts, and a subfolder of Inbox named "SubFolderA."

During the initial synchronization, JMAP’s ability to chain multiple requests into a single call significantly reduces the number of roundtrips needed compared to IMAP.

#### IMAP Initial Synchronization  

IMAP requires multiple roundtrips to achieve the initial synchronization. Let’s break down the steps involved:

1. Establish a Connection and Log In
```sql
C: LOGIN username password
S: OK LOGIN completed
```

2. Select the "Inbox" Folder for Synchronization
```sql
C: SELECT INBOX
S: * FLAGS (\Answered \Flagged \Draft \Deleted \Seen)
S: * OK [PERMANENTFLAGS (\Answered \Flagged \Draft \Deleted \Seen \*)] Flags permitted.
S: * OK [UIDVALIDITY 3857529045] UIDs valid.
S: * 1134 EXISTS
S: * 1 RECENT
S: * OK [UIDNEXT 4392] Predicted next UID.
S: * OK [HIGHESTMODSEQ 887]
S: SELECT completed.
```

3. Fetch Headers of Emails in the "Inbox"
```sql
C: FETCH 1:10 (ENVELOPE)
S: * 1 FETCH (ENVELOPE ("Tue, 1 Jan 2024 12:00:00 +0000" "Subject 1" (("Sender 1" NIL "sender1@example.com")) NIL NIL NIL NIL NIL))
S: * 2 FETCH (ENVELOPE ("Wed, 2 Jan 2024 12:00:00 +0000" "Subject 2" (("Sender 2" NIL "sender2@example.com")) NIL NIL NIL NIL NIL))
...
```

This process is repeated for the other two folders (Drafts and SubFolderA), resulting in at least two requests per folder. For this example with three folders, there are a minimum of 7 roundtrips.

#### JMAP Initial Synchronization

With JMAP, the same synchronization can be achieved with fewer roundtrips due to its ability to bundle multiple operations into a single request. Here's a simplified example of how this would look:

1. Fetch Folders and Messages in One Request
###### TODO "inMailbox" condition
```json 
{
    "using": ["urn:ietf:params:jmap:mail"],
    "methodCalls": [
        ["Mailbox/get", {"accountId": "user-id"}, "a"],
        ["Email/query", {"accountId": "user-id", "filter": {"inMailbox": "inbox-id"}, "limit": 10}, "b"],
        ["Email/get", {"accountId": "user-id", "#ids": {"resultOf": "b", "name": "Email/query", "path": "/ids"}}, "c"]
    ]
}
```

In this single JMAP request, we can:

- Fetch the list of folders.
- Query the emails in the Inbox.
- Get the details of the emails returned by the query.

This reduces the number of roundtrips drastically. Instead of 7 roundtrips (as in the IMAP example), we achieve the same with just 1 roundtrip.

## Re-Synchronization of Messages

Re-synchronization is another area where JMAP excels. IMAP often requires multiple calls to check for updates, fetch new messages, and reconcile state changes. JMAP, however, can handle these tasks more efficiently with fewer requests.

#### IMAP Re-Synchronization

IMAP re-synchronization involves several steps:

1. Check for New Messages
```
// TODO
```

2. Fetch New Messages
```
C: FETCH 3:* (ENVELOPE)
S: * 3 FETCH (ENVELOPE ("Thu, 3 Jan 2024 12:00:00 +0000" "Subject 3" (("Sender 3" NIL "sender3@example.com")) NIL NIL NIL NIL NIL))
```

This process involves multiple roundtrips as well, especially if you need to check multiple folders.

#### JMAP Re-Synchronization

JMAP simplifies re-synchronization with its ability to handle state changes efficiently in a single call:
```json
{
    "using": ["urn:ietf:params:jmap:mail"],
    "methodCalls": [
        ["Email/changes", {"accountId": "user-id", "sinceState": "previous-state-id"}, "d"],
        ["Email/get", {"accountId": "user-id", "#ids": {"resultOf": "d", "name": "Email/changes", "path": "/created"}}, "e"]
    ]
}

```


## Developer-Friendly Nature of JMAP
Implementing JMAP is significantly simpler than IMAP. Developers have found that JMAP takes about 1/10 of the time needed to implement IMAP. JMAP is like a fixed version of IMAP with all the extensions built-in. For example, if an IMAP server does not support the CONDSTORE/QRESYNC extensions, the client needs to fall back to slower methods of resynchronizing email states, which complicates the logic significantly. JMAP explicitly makes all those extensions part of the mandatory protocol, with fast synchronization being the most valuable. With JMAP, the app can ask what has changed in one call, compared to one call per folder with IMAP.